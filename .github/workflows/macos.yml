name: CD

on:
  push:
    branches: 
      - 'master'
  pull_request:
    branches: 
      - 'master'

jobs:
  Android:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v1
    - name: Setup variables
      uses: datamonsters/replace-action@v2
      with:
        files: 'CophiPoint/Api/AuthConstants.cs,CophiPoint/Config.cs'
        replacements: '$CLIENT_ID=${{ secrets.CLIENT_ID }},$CLIENT_SECRET=${{ secrets.CLIENT_SECRET }},$CUSTOM_SCHEME=${{ secrets.CUSTOM_SCHEME }},$CONFIG_URL=${{ secrets.CONFIG_URL }}'
    - name: Build APK
      run: |
        msbuild CophiPoint.Android/CophiPoint.Android.csproj /verbosity:normal /restore /t:SignAndroidPackage /p:Configuration=Release
    - name: Upload APK (arm64)
      uses: actions/upload-artifact@v1
      with:
        name: CophiPoint-arm64-v8a-Signed.apk
        path: CophiPoint.Android/bin/Release/cz.bubyx.CophiPoint-arm64-v8a-Signed.apk
    - name: Upload APK (armeabi)
      uses: actions/upload-artifact@v1
      with:
        name: CophiPoint-armeabi-v7a-Signed.apk
        path: CophiPoint.Android/bin/Release/cz.bubyx.CophiPoint-armeabi-v7a-Signed.apk
    - name: Upload APK (general)
      uses: actions/upload-artifact@v1
      with:
        name: CophiPoint-Signed.apk
        path: CophiPoint.Android/bin/Release/cz.bubyx.CophiPoint-Signed.apk
  
#  iOS:
#    runs-on: macos-latest
#    steps:
#    - uses: actions/checkout@v1
#    - name: Build
#      run: 
